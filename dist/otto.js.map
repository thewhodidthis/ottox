{"version":3,"file":"otto.js","sources":["../index.es"],"sourcesContent":["// # Otto\n// Helps deal CAs\n\n// Wrap index round edges\n// http://stackoverflow.com/questions/1082917/mod-of-negative-number-is-melting-my-brain\nconst myMod = (a, b) => a - (b * Math.floor(a / b));\n\n// Rule to binary convert\nconst parseRule = (rule) => {\n  // Base 2 digits\n  const code = rule.toString(2);\n\n  // Zero pad ruleset\n  const view = `0000000000000000000000000000000${code}`.substr(32 - code.length).split('').reverse();\n\n  return view;\n};\n\n// Defaults\nconst data = {\n  size: 1,\n  rule: 30,\n\n  // How far from center lie the neighbors\n  ends: [-1, 0, 1],\n\n  // Flip middle cell\n  seed: (v, i, view) => i === Math.floor(view.length * 0.5),\n\n  // Index based lookup\n  stat: (code, hood) => {\n    const stats = parseInt(hood.join('').toString(2), 2);\n    const state = code[stats];\n\n    return state;\n  },\n};\n\n// Setup\nconst Otto = (opts) => {\n  // Merge options and defaults\n  const { size, rule, ends, stat, seed } = Object.assign({}, data, opts);\n\n  // Store ruleset\n  const code = parseRule(rule);\n\n  // Calculate state\n  const getState = (v, i, view) => {\n    // Collect neighbors\n    const hood = ends.map((diff) => {\n      // The index for each neighbor cell\n      const site = myMod(diff + i, view.length);\n\n      // The state of each neighbor\n      const flag = view[site];\n\n      return flag;\n    });\n\n    return stat(code, hood, v);\n  };\n\n  // Clipboard, zero filled, need to work out adjustable size part\n  let next = new Uint8Array(size);\n\n  // Store results\n  let grid;\n\n  // Seed how on init\n  next = next.map(seed);\n\n  return () => {\n    // Update\n    grid = next;\n\n    // Save for later\n    next = grid.map(getState);\n\n    // The memo\n    return grid;\n  };\n};\n\nexport default Otto;\n\n"],"names":["myMod","a","b","Math","floor","parseRule","rule","code","toString","view","substr","length","split","reverse","data","size","ends","seed","v","i","stat","hood","stats","parseInt","join","state","Otto","opts","Object","assign","getState","map","diff","site","flag","next","Uint8Array","grid"],"mappings":"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"}