<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <title>Otto</title>
    <link rel="stylesheet" media="all" href="docco.css" />
  </head>

  <body>
    <div class="background"></div>

    

    <div class="sections">
      <ul>

        

        
        
        <li id="section-1" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-1">&#182;</a>
            </div>
            <h1 id="otto">Otto</h1>
<p>Helps deal CAs</p>

          </div>

          
        </li>
        
        
        <li id="section-2" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-2">&#182;</a>
            </div>
            <p>Wrap index round edges
<a href="http://stackoverflow.com/questions/1082917/mod-of-negative-number-is-melting-my-brain">http://stackoverflow.com/questions/1082917/mod-of-negative-number-is-melting-my-brain</a></p>

          </div>

          
          <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> myMod = <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> a - (b * <span class="hljs-built_in">Math</span>.floor(a / b));</pre></div></div>
          
        </li>
        
        
        <li id="section-3" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-3">&#182;</a>
            </div>
            <p>Rule to binary convert</p>

          </div>

          
          <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> parseRule = <span class="hljs-function">(<span class="hljs-params">rule</span>) =&gt;</span> {</pre></div></div>
          
        </li>
        
        
        <li id="section-4" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-4">&#182;</a>
            </div>
            <p>Base 2 digits</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> code = rule.toString(<span class="hljs-number">2</span>);</pre></div></div>
          
        </li>
        
        
        <li id="section-5" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-5">&#182;</a>
            </div>
            <p>Zero pad ruleset</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> view = <span class="hljs-string">`0000000000000000000000000000000<span class="hljs-subst">${code}</span>`</span>.substr(<span class="hljs-number">32</span> - code.length).split(<span class="hljs-string">''</span>).reverse();

  <span class="hljs-keyword">return</span> view;
};</pre></div></div>
          
        </li>
        
        
        <li id="section-6" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-6">&#182;</a>
            </div>
            <p>Defaults</p>

          </div>

          
          <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> data = {
  <span class="hljs-attr">size</span>: <span class="hljs-number">1</span>,
  <span class="hljs-attr">rule</span>: <span class="hljs-number">30</span>,</pre></div></div>
          
        </li>
        
        
        <li id="section-7" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-7">&#182;</a>
            </div>
            <p>How far from center lie the neighbors</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  ends: [<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>],</pre></div></div>
          
        </li>
        
        
        <li id="section-8" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-8">&#182;</a>
            </div>
            <p>Flip middle cell</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  seed: <span class="hljs-function">(<span class="hljs-params">v, i, view</span>) =&gt;</span> i === <span class="hljs-built_in">Math</span>.floor(view.length * <span class="hljs-number">0.5</span>),</pre></div></div>
          
        </li>
        
        
        <li id="section-9" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-9">&#182;</a>
            </div>
            <p>Index based lookup</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  stat: <span class="hljs-function">(<span class="hljs-params">code, hood</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> stats = <span class="hljs-built_in">parseInt</span>(hood.join(<span class="hljs-string">''</span>).toString(<span class="hljs-number">2</span>), <span class="hljs-number">2</span>);
    <span class="hljs-keyword">const</span> state = code[stats];

    <span class="hljs-keyword">return</span> state;
  },
};</pre></div></div>
          
        </li>
        
        
        <li id="section-10" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-10">&#182;</a>
            </div>
            <p>Setup</p>

          </div>

          
          <div class="content"><div class='highlight'><pre><span class="hljs-keyword">const</span> Otto = <span class="hljs-function">(<span class="hljs-params">opts</span>) =&gt;</span> {</pre></div></div>
          
        </li>
        
        
        <li id="section-11" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-11">&#182;</a>
            </div>
            <p>Merge options and defaults</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> { size, rule, ends, stat, seed } = <span class="hljs-built_in">Object</span>.assign({}, data, opts);</pre></div></div>
          
        </li>
        
        
        <li id="section-12" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-12">&#182;</a>
            </div>
            <p>Store ruleset</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> code = parseRule(rule);</pre></div></div>
          
        </li>
        
        
        <li id="section-13" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-13">&#182;</a>
            </div>
            <p>Calculate state</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">const</span> getState = <span class="hljs-function">(<span class="hljs-params">v, i, view</span>) =&gt;</span> {</pre></div></div>
          
        </li>
        
        
        <li id="section-14" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-14">&#182;</a>
            </div>
            <p>Collect neighbors</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">const</span> hood = ends.map(<span class="hljs-function">(<span class="hljs-params">diff</span>) =&gt;</span> {</pre></div></div>
          
        </li>
        
        
        <li id="section-15" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-15">&#182;</a>
            </div>
            <p>The index for each neighbor cell</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> site = myMod(diff + i, view.length);</pre></div></div>
          
        </li>
        
        
        <li id="section-16" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-16">&#182;</a>
            </div>
            <p>The state of each neighbor</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>      <span class="hljs-keyword">const</span> flag = view[site];

      <span class="hljs-keyword">return</span> flag;
    });

    <span class="hljs-keyword">return</span> stat(code, hood, v);
  };</pre></div></div>
          
        </li>
        
        
        <li id="section-17" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-17">&#182;</a>
            </div>
            <p>Clipboard, zero filled, need to work out adjustable size part</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">let</span> next = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(size);</pre></div></div>
          
        </li>
        
        
        <li id="section-18" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-18">&#182;</a>
            </div>
            <p>Store results</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  <span class="hljs-keyword">let</span> grid;</pre></div></div>
          
        </li>
        
        
        <li id="section-19" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-19">&#182;</a>
            </div>
            <p>Seed how on init</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>  next = next.map(seed);

  <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {</pre></div></div>
          
        </li>
        
        
        <li id="section-20" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-20">&#182;</a>
            </div>
            <p>Update</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>    grid = next;</pre></div></div>
          
        </li>
        
        
        <li id="section-21" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-21">&#182;</a>
            </div>
            <p>Save for later</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>    next = grid.map(getState);</pre></div></div>
          
        </li>
        
        
        <li id="section-22" class="section">
          <div class="annotation">
            
            <div class="pilwrap">
              <a class="pilcrow" href="#section-22">&#182;</a>
            </div>
            <p>The memo</p>

          </div>

          
          <div class="content"><div class='highlight'><pre>    <span class="hljs-keyword">return</span> grid;
  };
};

<span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> Otto;</pre></div></div>
          
        </li>
        

      </ul>
    </div>
  </body>
</html>
